<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{titulo}}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  </head>
  <body style="background-color: #1F4486;">

    <nav class="navbar navbar-expand-lg" data-bs-theme="dark" style="background-color: #1447AB; color: white; font-size: 15px;" >
      <div class="container-fluid" style="font-size: 18px;">
        <a class="navbar-brand" href="#">
          <img src="{{url_for('static',filename='image.png')}}" alt="Bootstrap" width="65" height="65" class="me-4">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" aria-current="page" href="#">HOME</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active btn" style="background-color: #383838;" href="{{ url_for('Missions.home')}}">MISSÕES</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">ESPAÇONAVES</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">TRIPULANTES</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">SOBRE MIM</a>
            </li>
          </ul>
          <a href="" class="btn me-2" style="background-color: #ffff; color: black;">sign-up</a>
          <a href="" class="btn" style="background-color: #383838;">login</a>
        </div>
      </div>
    </nav>  

    

    <div class="container-xl py-3 mt-3" style="background-color: #1E1E1E; color: white;">
      <!-- <p>{{Cargas}}</p> -->

       
      
      <form class="d-flex justify-content-center flex-column" onsubmit="Updateclient(event)">
        <input type="hidden" id="ms_id" value="{{id}}">
        <div class="mb-3 mt-3">
          <label for="Name" class="form-label">Nome da missão</label>
          <input type="text" class="form-control" id="Mission" aria-describedby="Name" value="{{nome}}">
        </div>
        <div class="mb-3">
          <label for="Tel" class="form-label">Destino</label>
          <input type="text" class="form-control" id="Destino"  value="{{Destino}}">
        </div>  

        <div class="mb-3">
          <label for="Tel" class="form-label">Data de Lançamento</label>
          <input type="text" class="form-control" id="Lancamento"  value="{{Lancamento}}">
        </div>  

        <div class="mb-3">
          <label for="Tel" class="form-label">Status</label>
          <input type="text" class="form-control" id="status"  value="{{Status}}">
        </div>  
        
        <div class="mb-3">
          <label for="Tel" class="form-label">Estado</label>
          <input type="textarea" class="form-control" id="Estado"  value="{{Estado}}">
        </div>  

        <div class="mb-3">
        <label for="tripulantes">Tripulação </label>
        <select class="selectpicker form-control" id="tripulantes" multiple>
          <optgroup label="Capitães" data-max-options="1">
          <option 
            {% if 'Capitão Jonas' in Tripulacao %}
              selected
            {% endif %} >Capitão Jonas</option>
          <option  
            {% if 'Capitã Erika' in Tripulacao %}
              selected
            {% endif %} >Capitã Erika</option>
          <option
            {% if 'Capitão David' in Tripulacao %}
              selected
            {% endif %} >Capitão David</option>
          </optgroup>
          <optgroup label="Exploradores" data-max-options="2">
            <option  
            {% if 'Explorador Lucas' in Tripulacao %}
            selected
            {% endif %} >Explorador Lucas</option>
            <option
            {% if 'Exploradora Maria' in Tripulacao %}
            selected
            {% endif %} >Exploradora Maria</option>
            <option
            {% if 'Exploradora Angelica' in Tripulacao %}
            selected
            {% endif %} >Exploradora Angelica</option>
          </optgroup>
        </select>     
        </div>
  
        <div class="container mb-3">
          <p>Cargas</p>
          
         <div class="row gap-3 justify-content-md-center">
              <div class="card border-light" style="width: 15rem; background-color: transparent; border: none;">
                <img src="{{url_for('static',filename='Espectrômetro.png')}}" class="card-img-top" style="height: 202px;" alt="...">
              <div class="card-body" style="background-color: #383838;">
                <h5 class="card-title" style="color: white;">Espectrômetro</h5>
                <input type="checkbox" class="btn-check select-cargas" id="btn-Espectrômetro" name="Espectrômetro"  autocomplete="off" value="100" {% if 'Espectrômetro' in Cargas %}
                checked
                {% endif %}>
                <label class="btn btn-outline-primary" for="btn-Espectrômetro" style="color: white;">Selecionar</label>   
              </div>
            </div>
            
            <div class="card border-light" style="width: 15rem ; background-color: transparent; border: none;">
              <img src="{{url_for('static',filename='Rover.png')}}" class="card-img-top" style="height: 202px;" alt="...">
              <div class="card-body" style="background-color: #383838;">
                <h5 class="card-title" style="color: white;">Rover Espacial</h5>
                <input type="checkbox" class="btn-check select-cargas" id="btn-Rover Espacial"  name="Rover Espacial" autocomplete="off" value="100" {% if 'Rover Espacial' in Cargas %}
                checked
                {% endif %}>
                <label class="btn btn-outline-primary" for="btn-Rover Espacial" style="color: white;">Selecionar</label>   
              </div>
            </div>
            
            <div class="card border-light" style="width: 15rem; background-color: transparent; border: none;">
              <img src="{{url_for('static',filename='Painel Solar.png')}}" class="card-img-top" style="height: 202px;" alt="...">
              <div class="card-body" style="background-color: #383838;">
                <h5 class="card-title" style="color: white;">Painel Solar</h5>
                <input type="checkbox" class="btn-check select-cargas" id="btn-Painel-Solar" name="Painel-Solar" autocomplete="off" value="100" {% if 'Painel-Solar' in Cargas %}
                checked
                {% endif %}>
                <label class="btn btn-outline-primary" for="btn-Painel-Solar" style="color: white;">Selecionar</label>   
              </div>
            </div>
  
            <div class="card border-light" style="width: 15rem; background-color: transparent; border: none;">
              <img src="{{url_for('static',filename='Painel Solar 2.png')}}" class="card-img-top" style="height: 202px;"  alt="...">
              <div class="card-body" style="background-color: #383838;">
                <h5 class="card-title" style="color: white;">Painel Solar duplo</h5>
                <input type="checkbox" class="btn-check select-cargas" id="btn-Painel-Solar-2" name="Painel-Solar Duplo" autocomplete="off" value="800"  {% if 'Painel-Solar Duplo' in Cargas %}
                checked
                {% endif %}>
                <label class="btn btn-outline-primary" for="btn-Painel-Solar-2" style="color: white;">Selecionar</label>   
              </div>
           </div>
        
          <div class="row gap-3 justify-content-md-center">
                <div class="card border-light" style="width: 15rem; background-color: transparent; border: none;">
                  <img src="{{url_for('static',filename='Satelite.png')}}" class="card-img-top" style="height: 202px;" alt="...">
                <div class="card-body" style="background-color: #383838;">
                  <h5 class="card-title" style="color: white;">Satelite</h5>
                  <input type="checkbox" class="btn-check select-cargas" id="btn-Satelite" autocomplete="off" value="700"  {% if 'Satelite' in Cargas %}
                  checked
                  {% endif %}>
                  <label class="btn btn-outline-primary" for="btn-Satelite" style="color: white;">Selecionar</label>   
                </div>
              </div>
              
              <div class="card border-light" style="width: 15rem; background-color: transparent; border: none;">
                <img src="{{url_for('static',filename='Suprimentos.png')}}" class="card-img-top" style="height: 202px;" alt="...">
                <div class="card-body" style="background-color: #383838;">
                  <h5 class="card-title" style="color: white;">kit de suprimentos</h5>
                  <input type="checkbox" class="btn-check select-cargas" id="btn-Suprimentos" name="Caixa de suprimentos" autocomplete="off" value="400"  {% if 'Caixa de suprimentos' in Cargas %}
                  checked
                  {% endif %}> 
                  <label class="btn btn-outline-primary" for="btn-Suprimentos" style="color: white;">Selecionar</label>   
                </div>
              </div>
              
              <div class="card border-light" style="width: 15rem; background-color: transparent; border: none;">
                <img src="{{url_for('static',filename='Health-kit.png')}}" class="card-img-top" style="height: 202px;" alt="...">
                <div class="card-body" style="background-color: #383838;">
                  <h5 class="card-title" style="color: white;">Kit medico</h5>
                  <input type="checkbox" class="btn-check select-cargas" id="btn-medic" name="Kit medico" autocomplete="off" value="300"  {% if 'Kit medico' in Cargas %}
                  checked
                  {% endif %}>>
                  <label class="btn btn-outline-primary" for="btn-medic" style="color: white;">Selecionar</label>   
                </div>
              </div>
  
              <div class="card border-light" style="width: 15rem; background-color: transparent; border: none;">
                <img src="{{url_for('static',filename='Tanque de oxigenio.png')}}" class="card-img-top" style="height: 202px;" alt="...">
                <div class="card-body" style="background-color: #383838;">
                  <h5 class="card-title" style="color: white;">Tanque de Oxigenio</h5>
                  <input type="checkbox" class="btn-check select-cargas" id="btn-oxygen" name="Tanque de oxigenio" autocomplete="off" value="200"  {% if 'Tanque de oxigenio' in Cargas %}
                  checked
                  {% endif %}>>
                  <label class="btn btn-outline-primary" for="btn-oxygen" style="color: white;">Selecionar</label>   
                </div>
              </div>
        </div>
      </div>
        </div>
  
      <div class="container">
        <div class="row">
          <label for="customRange1">Duração</label>
        </div>
        <div class="row justify-content-md-center text-center">
          <input type="range" onclick="myrange()" class="custom-range" min="0" max="100" value="{{Duracao}}" id="Duration" style="width: 70%;">
          <p><span id="duration-amount">{{Duracao}} </span>Anos luz</p>
        </div>
      </div>
    
      <div class="container mb-3">
          <p>Naves</p>
          
         <div class="row gap-5 justify-content-md-center">
              <div class="card border-light" style="width: 15rem; background-color: transparent; border: none;">
                <img src="{{url_for('static',filename='Nave-1.png')}}" class="card-img-top" style=" width: 200px;" alt="...">
              <div class="card-body" style="background-color: #383838; width: 200px;">
                <h5 class="card-title" style="color: white;">Prometheus</h5>
                <input type="checkbox" class="btn-check select-nave" name="Prometheus" id="Nave" autocomplete="off" value="300"  {% if 'Prometheus' in Nave  %}
                checked
              {% endif %}>
                <label class="btn btn-outline-primary" for="Nave" style="color: white;">Selecionar</label>   
              </div>
            </div>
            
            <div class="card border-light" style="width: 15rem; background-color: transparent; border: none;">
              <img src="{{url_for('static',filename='Nave-2.png')}}" class="card-img-top"  style="width: 200px;" alt="...">
              <div class="card-body" style="background-color: #383838; width: 200px;">
                <h5 class="card-title" style="color: white;">USS Voyager</h5>
                <input type="checkbox"  class="btn-check select-nave" name="USS Voyager" id="Nave-2" autocomplete="off" value="100" {% if 'USS Voyager' in Nave %}
                checked
              {% endif %}>>
                <label class="btn btn-outline-primary" for="Nave-2" style="color: white;">Selecionar</label>   
              </div>
            </div>
            
            <div class="card border-light" style="width: 15rem; background-color: transparent; border: none;">
              <img src="{{url_for('static',filename='Nave-3.png')}}" class="card-img-top"  style=" width: 200px;" alt="...">
              <div class="card-body" style="background-color: #383838;  width: 200px;">
                <h5 class="card-title" style="color: white;">SS Discovery</h5>
                <input type="checkbox" class="btn-check select-nave" name="SS Discovery" id="Nave-3" autocomplete="off" value="150"  {% if 'SS Discovery' in Nave  %}
                checked
              {% endif %}>
                <label class="btn btn-outline-primary" for="Nave-3" style="color: white;">Selecionar</label>   
              </div>
            </div>
        </div>
        </div>
        
        <div class="mb-3">
          <fieldset disabled>
          <label for="cust" class="form-label">Custo</label>
          <input type="text" id="cust" class="Custo" class="form-control" placeholder="0$" value="{{Custo}}">
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
    </div>
  </body>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
   <!-- Bootstrap JS -->
   <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
   <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.18/css/bootstrap-select.min.css" rel="stylesheet">
   
 <!-- Bootstrap Select JS -->
 <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.18/js/bootstrap-select.min.js"></script>
    <script>

$(document).ready(function() {
    $('.selectpicker').selectpicker();

    $('.select-nave').on('change', function() {
        // Desmarcar todos os outros checkboxes
        $('.select-nave').not(this).prop('checked', false);
        
        // Capturar o valor do checkbox marcado
        navevalue = $(this).val(); // Pega o valor do checkbox selecionado
        // console.log(navevalue); // Verifique se o valor está correto no console
        
        // Atualizar o valor de .Custo
        if ($(this).prop('checked')) {
            $('.Custo').val(function(index, value) {
                return Number(value) + Number(navevalue);
            });
        } else {
            $('.Custo').val(function(index, value) {
                return Number(value) - Number(navevalue);
            });
        }
    });

    $('.select-cargas').on('change', function() {
        // Desmarcar todos os outros checkboxes

        // var cargasValidadas = $('.select-cargas:checked').map(function() {
        // return $(this).attr('name');
        // }).get();

        // console.log(cargasValidadas)
        
        // Capturar o valor do checkbox marcado
        cargasvalue = $(this).val(); // Pega o valor do checkbox selecionado
        // console.log(cargasvalue); // Verifique se o valor está correto no console
        
        // Atualizar o valor de .Custo
        if ($(this).prop('checked')) {
            $('.Custo').val(function(index, value) {
                return Number(value) + Number(cargasvalue);
            });
        } else {
            $('.Custo').val(function(index, value) {
                return Number(value) - Number(cargasvalue);
            });
        }
    });

  });  
    
    function post(url, body, callback) {
    let request = new XMLHttpRequest();
    request.open("PUT", url, true);

    // Definir o cabeçalho para JSON
    request.setRequestHeader("Content-Type", "application/json");

    // Função a ser chamada quando a resposta for recebida
    request.onload = function () {
        if (request.status >= 200 && request.status < 300) {
            // Chama a função de callback com a resposta do servidor
            callback(null, request.responseText);
        } else {
            // Chama o callback com o erro
            callback(`Erro: ${request.statusText}`);
        }
    };

    // Caso haja erro na requisição
    request.onerror = function () {
        callback("Erro de rede.");
    };

    // Envia os dados em formato JSON
    request.send(JSON.stringify(body));
}

function Updateclient(event) {
    // Prevenir o comportamento padrão do formulário (evita o reload da página)
    event.preventDefault();

    // Definir o URL da API
    let url = "http://localhost:5000/Mission/att/submit";

    // Capturar os valores dos campos de entrada
        let id = document.getElementById('ms_id').value
        let nome = document.getElementById("Mission").value
        let Destino = document.getElementById("Destino").value
        let Lancamento = document.getElementById("Lancamento").value
        let Estado = document.getElementById("Estado").value
        let status = document.getElementById("status").value
        let tripulantes = ($('#tripulantes').val()).toString()
        let CargasList = $('.select-cargas:checked').map(function() {
        return $(this).attr('name');
        }).get();
        let duracao = document.getElementById("Duration").value
        let NaveList = $('.select-nave:checked').map(function() {
          return $(this).attr('name');
        }).get();      //   
        let Cargas = CargasList.toString()
        let Nave = NaveList.toString()
        let cust = document.getElementById("cust").value

    // Criar o objeto com os dados do formulário
    body = {
          id: id,
          Nome: nome,
          Destino: Destino,
          Lancamento: Lancamento, 
          Tripulacao: tripulantes,
          Estado: Estado, 
          Custo: cust,
          Cargas: Cargas, 
          Status: status,
          Duracao: duracao, 
          Nave:  Nave 
        }

    // Chamar a função post e lidar com a resposta da API
    post(url, body, function (err, response) {
        if (err) {
            // Exibe o erro no console ou em algum lugar na página
            console.error(err);
        } else {
            // Exibe a resposta no console ou em algum lugar na página
            console.log("Resposta do servidor:", response);
            window.location.href = "{{url_for('Missions.home')}}";
          }
    });

  

}

function myrange(){
    rangeInput = document.getElementById("Duration").value
    rangeText = document.getElementById("duration-amount").textContent = rangeInput + " ";

  }
    </script>
   
</html